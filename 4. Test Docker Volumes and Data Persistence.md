**🐳 🔄  Docker Volumes and Data Persistence — Step-by-Step SOP**

---

### 🧩 Step 1: List existing volumes

```bash
docker volume ls
```

**Output:**

```
DRIVER    VOLUME NAME
```

(Empty because no volume exists yet)

---

### 🧩 Step 2: Create a new volume

```bash
docker volume create mysql-data
```

**Output:**

```
mysql-data
```

---

### 🧩 Step 3: Verify the volume was created

```bash
docker volume ls
```

**Output:**

```
DRIVER    VOLUME NAME
local     mysql-data
```

---

### 🧩 Step 4: Run a MySQL container with attached volume

```bash
docker run -d \
  --name mysql-server \
  -e MYSQL_ROOT_PASSWORD=Sandip123 \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8
```

**Output:**

```
Unable to find image 'mysql:8' locally
8: Pulling from library/mysql
806f49275b8e: Pull complete
...
Status: Downloaded newer image for mysql:8
c52c9b93f6e9dbd4d9d9bb7d896adceeea34b6227b879a9b1cb47a356faac6f9
```

---

### 🧩 Step 5: Verify the container is running

```bash
docker ps
```

**Output:**

```
CONTAINER ID   IMAGE      COMMAND                  STATUS         PORTS                    NAMES
c52c9b93f6e9   mysql:8    "docker-entrypoint.s…"   Up 10 seconds  0.0.0.0:3306->3306/tcp   mysql-server
```

---

### 🧩 Step 6: Access the MySQL shell

```bash
docker exec -it mysql-server mysql -u root -p
```

**Input password:**

```
Enter password: Sandip123
```

---

### 🧩 Step 7: Create a database, table, and insert single value

```sql
CREATE DATABASE testdb;
USE testdb;

CREATE TABLE users (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(50)
);

INSERT INTO users (name) VALUES ('Sandip');

SELECT * FROM users;
```

**Output:**

```
Query OK, 1 row affected (0.01 sec)
Database changed
Query OK, 0 rows affected (0.02 sec)
Query OK, 1 row affected (0.01 sec)

+----+--------+
| id | name   |
+----+--------+
|  1 | Sandip |
+----+--------+
1 row in set (0.00 sec)
```

---

### 🧩 Step 8: Exit MySQL and stop container

```bash
exit
docker stop mysql-server
docker rm mysql-server
```

**Output:**

```
mysql-server
mysql-server
```

---

### 🧩 Step 9: Recreate container and verify data persistence

```bash
docker run -d \
  --name mysql-server \
  -e MYSQL_ROOT_PASSWORD=Sandip123 \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8
```

**Output:**

```
a8345d5f2416a43a857a1d9ab5427c10e09e52dfb42f0c1e3b1229ffb52e2bc3
```

Now recheck the data:

```bash
docker exec -it mysql-server mysql -u root -p
```

Enter:

```
Enter password: Sandip123
```

Then run:

```sql
USE testdb;
SELECT * FROM users;
```

**Output:**

```
Database changed
+----+--------+
| id | name   |
+----+--------+
|  1 | Sandip |
+----+--------+
1 row in set (0.00 sec)
```

✅ **Data persisted** — because the volume `mysql-data` stored all the MySQL files.

---

### 🧩 Step 10: Optional — Clean up

```bash
docker stop mysql-server
docker rm mysql-server
docker volume rm mysql-data
```

**Output:**

```
mysql-server
mysql-server
mysql-data
```


## 🧠 Step 11: Attaching Volumes from Dockerfile (Advanced)

You can also attach a volume **directly inside a Dockerfile** using the `VOLUME` instruction:

```Dockerfile
FROM mysql:8
VOLUME /var/lib/mysql
```

🧩 **Explanation:**

* This approach automatically creates an **anonymous volume** for `/var/lib/mysql`.
* These anonymous volumes have **randomly generated names** like:

  ```
  local     9c3f56e12345abc6789defghijklmnopqrs_tuvwx
  ```
* Because of such naming, it’s **difficult to identify or manage** them later.
* Hence, in real-world setups or learning environments, it’s **better to use named volumes** with the `-v` option during `docker run`.

✅ Using **named volumes** (like `mysql-data`) gives **better control, visibility, and reusability**. ✨


---

## ✅ Final Conclusion

✔️ Docker Volumes ensure **data persistence** for MySQL even after container removal.
✔️ SQL data inside `demo_db` remains safe across container restarts.
✔️ Using `-v` named volumes is **simpler and more traceable** than Dockerfile-defined anonymous volumes.

