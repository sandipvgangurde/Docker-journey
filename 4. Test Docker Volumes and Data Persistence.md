# 🐳 Docker Volumes & Data Persistence — SOP

## 🎯 Objective

Learn how to **persist container data** using **Docker volumes**, so data remains even if containers are removed or recreated.
Hands-on with **MySQL container** to demonstrate data persistence.

---

## ⚙️ Key Concepts

| Type             | Description                                             | Example                                       |
| :--------------- | :------------------------------------------------------ | :-------------------------------------------- |
| **Named Volume** | Managed by Docker, stored in `/var/lib/docker/volumes/` | `mysql-data`                                  |
| **Bind Mount**   | Maps a host directory to container directory            | `/home/sandipvilas/mysql-data:/var/lib/mysql` |

---

## 📝 Steps & Commands with Output

### 1️⃣ Create & Run MySQL Container with Named Volume

```bash
docker run -d \
  --name mysql-server \
  -e MYSQL_ROOT_PASSWORD=Sandip123 \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8
```

**Output:**

```
Unable to find image 'mysql:8' locally
8: Pulling from library/mysql
... [layers downloaded]
Digest: sha256:5367102acfefeaa47eb0eb57c8d4f8b96c8c14004859131eac9bbfaa62f81e34
Status: Downloaded newer image for mysql:8
3e62ba4caeba33371e8225b75c6fdb244386a8026cb7711437f8fa6d5507cd72
```

---

### 2️⃣ Access MySQL Container

```bash
docker exec -it mysql-server bash
```

**Inside container:**

```bash
mysql -uroot -p
```

**Sample errors if password incorrect:**

```
ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)
```

**Successful login:**

```
Welcome to the MySQL monitor. Commands end with ; or \g.
Server version: 8.4.6 MySQL Community Server - GPL
```

---

### 3️⃣ Create Database & Table, Insert Data

```sql
CREATE DATABASE testdb;
USE testdb;
CREATE TABLE users(id INT, name VARCHAR(50));
INSERT INTO users VALUES(1, 'Sandip');
SELECT * FROM users;
```

**Output:**

```
+------+--------+
| id   | name   |
+------+--------+
|    1 | Sandip |
+------+--------+
1 row in set (0.01 sec)
```

---

### 4️⃣ Stop & Remove Container

```bash
docker stop mysql-server
docker rm mysql-server
```

**Check container status:**

```bash
docker ps -a
```

**Output (container removed, volume remains):**

```
CONTAINER ID   IMAGE     COMMAND    STATUS    PORTS    NAMES
```

---

### 5️⃣ Inspect Volumes

```bash
docker volume ls
```

**Output:**

```
DRIVER    VOLUME NAME
local     mysql-data
```

```bash
docker volume inspect mysql-data
```

**Output:**

```json
[
    {
        "CreatedAt": "2025-10-14T08:01:56Z",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/mysql-data/_data",
        "Name": "mysql-data",
        "Options": null,
        "Scope": "local"
    }
]
```

---

### 6️⃣ Verify Data Persistence

Run a new MySQL container using the same volume:

```bash
docker run -d \
  --name mysql-server \
  -e MYSQL_ROOT_PASSWORD=Sandip123 \
  -v mysql-data:/var/lib/mysql \
  -p 3306:3306 \
  mysql:8
```

**Check existing data:**

```bash
docker exec -it mysql-server mysql -uroot -p
USE testdb;
SELECT * FROM users;
```

**Output:**

```
+------+--------+
| id   | name   |
+------+--------+
|    1 | Sandip |
+------+--------+
1 row in set (0.00 sec)
```

> ✅ Data persisted successfully even after removing and recreating the container.

---

### 7️⃣ Explore Volume Data on Host

```bash
cd /var/lib/docker/volumes/mysql-data/_data
ls -l
```

**Output (key MySQL files):**

```
total 96184
-rw-r----- 1 999 systemd-journal  4194304 #ib_16384_0.dblwr
-rw-r----- 1 999 systemd-journal 12582912 #ib_16384_1.dblwr
drwxr-x--- 2 999 systemd-journal 4096 mysql
drwxr-x--- 2 999 systemd-journal 4096 testdb
...
```

---

### 🔁 Summary

1. **Created a named volume** `mysql-data`.
2. **Ran a MySQL container** using the volume.
3. **Created database/table & inserted data**.
4. **Removed the container** — data persisted.
5. **Recreated container** using same volume — data intact.
6. **Verified volume files** on host system.

---

### 📂 Folder Structure in Repo

```
mysql-volume-demo/
│
├─ README.md  # SOP documentation
├─ mysql-data-demo.sh  # Commands to run MySQL container with volume
└─ screenshots/  # Optional: screenshots of terminal outputs
```

---
